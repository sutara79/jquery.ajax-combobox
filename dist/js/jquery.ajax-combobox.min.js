/**
 * @file jquery.ajax-combobox
 * @version 7.4.6
 * @author Yuusaku Miyazaki <toumin.m7@gmail.com>
 * @license MIT
 */
!function(e){"object"==typeof module&&"object"==typeof module.exports?e(require("jquery"),window,document):e(jQuery,window,document)}(function(e,t,s,o){e.fn.ajaxComboBox=function(t,s){var n=[];return this.each(function(){n.push(new e.ajaxComboBox(this,t,s))}),s!==o&&s.instance!==o&&s.instance?e(n):this},e.ajaxComboBox=function(e,t,s){this.option=this._setOption(t,s),this._setMessage(),this._setCssClass(),this._setProp(),this._setElem(e),this._setButtonAttrDefault(),this._setInitRecord(),this._ehButton(),this._ehComboInput(),this._ehWhole(),this._ehTextArea(),this.option.shorten_btn&&this._findUrlToShorten(this)},e.extend(e.ajaxComboBox.prototype,{_setOption:function(e,t){return t=this._setOption1st(e,t),t=this._setOption2nd(t)},_setOption1st:function(t,s){return e.extend({source:t,lang:"en",plugin_type:"combobox",init_record:!1,db_table:"tbl",field:"name",and_or:"AND",per_page:10,navi_num:5,primary_key:"id",button_img:"dist/btn.png",bind_to:!1,navi_simple:!1,sub_info:!1,sub_as:{},show_field:"",hide_field:"",select_only:!1,tags:!1,shorten_btn:!1,shorten_src:"dist/bitly.php",shorten_min:20,shorten_reg:!1},s)},_setOption2nd:function(e){return e.search_field=e.search_field?e.search_field:e.field,e.and_or=e.and_or.toUpperCase(),e.hide_field=this._strToArray(e.hide_field),e.show_field=this._strToArray(e.show_field),e.search_field=this._strToArray(e.search_field),""===e.show_field[0]&&(e.show_field[0]="*"),e.order_by=e.order_by===o?e.search_field:e.order_by,e.order_by=this._setOrderbyOption(e.order_by,e.field),"textarea"==e.plugin_type&&(e.shorten_reg=this._setRegExpShort(e.shorten_reg,e.shorten_min)),e.tags&&(e.tags=this._setTagPattern(e)),e},_strToArray:function(e){return e.replace(/[\s　]+/g,"").split(",")},_setRegExpShort:function(e,t){if(e)return e;var s="(?:^|[\\s|　\\[(<「『（【［＜〈《]+)";return s+="(",s+="https:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(t-7)+",}",s+="|",s+="http:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(t-6)+",}",s+="|",s+="ftp:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(t-5)+",}",s+=")",new RegExp(s,"g")},_setTagPattern:function(e){for(var t=0;t<e.tags.length;t++)e.tags[t]=this._setTagOptions(e,t),e.tags[t].pattern=this._setRegExpTag(e.tags[t].pattern,e.tags[t].space);return e.tags},_setTagOptions:function(t,s){t.tags[s]=e.extend({space:[!0,!0],db_table:t.db_table,field:t.field,search_field:t.search_field,primary_key:t.primary_key,sub_info:t.sub_info,sub_as:t.sub_as,show_field:t.show_field,hide_field:t.hide_field},t.tags[s]);for(var n=["hide_field","show_field","search_field"],i=0;i<n.length;i++)"object"!=typeof t.tags[s][n[i]]&&(t.tags[s][n[i]]=this._strToArray(t.tags[s][n[i]]));return t.tags[s].order_by=t.tags[s].order_by===o?t.order_by:this._setOrderbyOption(t.tags[s].order_by,t.tags[s].field),t.tags[s]},_setRegExpTag:function(e,t){var s=e[0].replace(/[\s\S]*/,this._escapeForReg),o=e[1].replace(/[\s\S]*/,this._escapeForReg);return{left:e[0],right:e[1],reg_left:new RegExp(s+"((?:(?!"+s+"|"+o+")[^\\s　])*)$"),reg_right:new RegExp("^((?:(?!"+s+"|"+o+")[^\\s　])+)"),space_left:new RegExp("^"+s+"$|[\\s　]+"+s+"$"),space_right:new RegExp("^$|^[\\s　]+"),comp_right:new RegExp("^"+o)}},_escapeForReg:function(e){return"\\u"+(65536+e.charCodeAt(0)).toString(16).slice(1)},_setOrderbyOption:function(t,s){var o=[],n=[];if("object"==typeof t)for(var i=0;i<t.length;i++)n=e.trim(t[i]).split(" "),o[i]=2==n.length?n:[n[0],"ASC"];else n=e.trim(t).split(" "),o[0]=2==n.length?n:n[0].match(/^(ASC|DESC)$/i)?[s,n[0]]:[n[0],"ASC"];return o},_setMessage:function(){var e;switch(this.option.lang){case"de":e={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+this.option.per_page+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+this.option.per_page+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten. (ajax-combobox)"};break;case"en":e={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+this.option.per_page+" (Right key)",prev:"Prev",prev_title:"Prev"+this.option.per_page+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server. (ajax-combobox)"};break;case"es":e={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+this.option.per_page+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+this.option.per_page+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor. (ajax-combobox)"};break;case"pt-br":e={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+this.option.per_page+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+this.option.per_page+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor. (ajax-combobox)"};break;default:e={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+this.option.per_page+"件 (右キー)",prev:"前へ",prev_title:"前の"+this.option.per_page+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。(ajax-combobox)"}}this.message=e},_setCssClass:function(){var t={container:"ac_container",container_open:"ac_container_open",selected:"ac_selected",re_area:"ac_result_area",navi:"ac_navi",results:"ac_results",re_off:"ac_results_off",select:"ac_over",sub_info:"ac_subinfo",select_ok:"ac_select_ok",select_ng:"ac_select_ng",input_off:"ac_input_off"};switch(this.option.plugin_type){case"combobox":t=e.extend(t,{button:"ac_button",btn_on:"ac_btn_on",btn_out:"ac_btn_out",input:"ac_input"});break;case"simple":t=e.extend(t,{input:"ac_s_input"});break;case"textarea":t=e.extend(t,{input:"ac_textarea",btn_short_off:"ac_btn_short_off"})}this.css_class=t},_setProp:function(){this.prop={timer_valchange:!1,is_suggest:!1,page_all:1,page_suggest:1,max_all:1,max_suggest:1,is_paging:!1,is_loading:!1,reserve_btn:!1,reserve_click:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",size_navi:null,size_results:null,size_li:null,size_left:null,tag:null}},_setElem:function(t){var s={};if(s.combo_input=e(t).attr("autocomplete","off").addClass(this.css_class.input).wrap("<div>"),s.container=e(s.combo_input).parent().addClass(this.css_class.container),"combobox"==this.option.plugin_type?(s.button=e("<div>").addClass(this.css_class.button),s.img=e("<img>").attr("src",this.option.button_img)):(s.button=!1,s.img=!1),s.result_area=e("<div>").addClass(this.css_class.re_area),s.navi=e("<div>").addClass(this.css_class.navi),s.navi_info=e("<div>").addClass("info"),s.navi_p=e("<p>"),s.results=e("<ul>").addClass(this.css_class.results),s.sub_info=e("<div>").addClass(this.css_class.sub_info),"textarea"==this.option.plugin_type)s.hidden=!1;else{var n=e(s.combo_input).attr("name")!==o?e(s.combo_input).attr("name"):e(s.combo_input).attr("id");n.match(/\]$/)?n=n.replace(/\]?$/,"_primary_key]"):n+="_primary_key",s.hidden=e('<input type="hidden" />').attr({name:n,id:n}).val("")}switch(this.option.plugin_type){case"combobox":e(s.container).append(s.button).append(s.result_area).append(s.hidden),e(s.button).append(s.img);break;case"simple":e(s.container).append(s.result_area).append(s.hidden);break;case"textarea":e(s.container).append(s.result_area)}e(s.result_area).append(s.navi).append(s.results).append(s.sub_info),e(s.navi).append(s.navi_info).append(s.navi_p),"combobox"==this.option.plugin_type?e(s.container).width(e(s.combo_input).outerWidth()+e(s.button).outerWidth()):e(s.container).width(e(s.combo_input).outerWidth()),this.elem=s},_setButtonAttrDefault:function(){this.option.select_only&&(""!==e(this.elem.combo_input).val()?"textarea"!=this.option.plugin_type&&(""!==e(this.elem.hidden).val()?e(this.elem.combo_input).attr("title",this.message.select_ok).removeClass(this.css_class.select_ng).addClass(this.css_class.select_ok):e(this.elem.combo_input).attr("title",this.message.select_ng).removeClass(this.css_class.select_ok).addClass(this.css_class.select_ng)):("textarea"!=this.option.plugin_type&&e(this.elem.hidden).val(""),e(this.elem.combo_input).removeAttr("title").removeClass(this.css_class.select_ng))),"combobox"==this.option.plugin_type&&(e(this.elem.button).attr("title",this.message.get_all_btn),e(this.elem.img).attr("src",this.option.button_img))},_setInitRecord:function(){if(!1!==this.option.init_record)if("textarea"!=this.option.plugin_type&&e(this.elem.hidden).val(this.option.init_record),"object"==typeof this.option.source){for(var t,s=0;s<this.option.source.length;s++)if(this.option.source[s][this.option.primary_key]==this.option.init_record){t=this.option.source[s];break}this._afterInit(this,t)}else{var o=this;e.ajax({dataType:"json",url:o.option.source,data:{db_table:this.option.db_table,pkey_name:this.option.primary_key,pkey_val:this.option.init_record},success:function(e){o._afterInit(o,e)},error:function(e,t,s){o._ajaxErrorNotify(o,s)}})}},_afterInit:function(t,s){e(t.elem.combo_input).val(s[t.option.field]),"textarea"!=t.option.plugin_type&&e(t.elem.hidden).val(s[t.option.primary_key]),t.prop.prev_value=s[t.option.field],t.option.select_only&&e(t.elem.combo_input).attr("title",t.message.select_ok).removeClass(t.css_class.select_ng).addClass(t.css_class.select_ok)},_ehButton:function(){if("combobox"==this.option.plugin_type){var t=this;e(t.elem.button).mouseup(function(s){e(t.elem.result_area).is(":hidden")?(clearInterval(t.prop.timer_valchange),t.prop.is_suggest=!1,t._suggest(t),e(t.elem.combo_input).focus()):t._hideResults(t),s.stopPropagation()}).mouseover(function(){e(t.elem.button).addClass(t.css_class.btn_on).removeClass(t.css_class.btn_out)}).mouseout(function(){e(t.elem.button).addClass(t.css_class.btn_out).removeClass(t.css_class.btn_on)}).mouseout()}},_ehComboInput:function(){var t=this;e(t.elem.combo_input).keydown(function(e){t._processKey(t,e)}),e(t.elem.combo_input).focus(function(){t._setTimerCheckValue(t)}).click(function(){t._setCssFocusedInput(t),e(t.elem.results).children("li").removeClass(t.css_class.select)})},_ehWhole:function(){var t=this,s=!1;e(t.elem.container).mousedown(function(){s=!0}),e("html").mousedown(function(){s?s=!1:t._hideResults(t)})},_ehResults:function(){var t=this;e(t.elem.results).children("li").mouseover(function(){t.prop.key_select?t.prop.key_select=!1:(t._setSubInfo(t,this),e(t.elem.results).children("li").removeClass(t.css_class.select),e(this).addClass(t.css_class.select),t._setCssFocusedResults(t))}).click(function(e){t.prop.key_select?t.prop.key_select=!1:(e.preventDefault(),e.stopPropagation(),t._selectCurrentLine(t,!1))})},_ehNaviPaging:function(t){e(t.elem.navi).find(".navi_first").mouseup(function(s){e(t.elem.combo_input).focus(),s.preventDefault(),t._firstPage(t)}),e(t.elem.navi).find(".navi_prev").mouseup(function(s){e(t.elem.combo_input).focus(),s.preventDefault(),t._prevPage(t)}),e(t.elem.navi).find(".navi_page").mouseup(function(s){e(t.elem.combo_input).focus(),s.preventDefault(),t.prop.is_suggest?t.prop.page_suggest=parseInt(e(this).text(),10):t.prop.page_all=parseInt(e(this).text(),10),t.prop.is_paging=!0,t._suggest(t)}),e(t.elem.navi).find(".navi_next").mouseup(function(s){e(t.elem.combo_input).focus(),s.preventDefault(),t._nextPage(t)}),e(t.elem.navi).find(".navi_last").mouseup(function(s){e(t.elem.combo_input).focus(),s.preventDefault(),t._lastPage(t)})},_ehTextArea:function(){var t=this;t.option.shorten_btn&&e(t.option.shorten_btn).click(function(){t._getShortURL(t)})},_getShortURL:function(t){e(t.elem.combo_input).attr("disabled","disabled");for(var s=e(t.elem.combo_input).val(),o=[],n=null;null!==(n=t.option.shorten_reg.exec(s));)o[o.length]=n[1];if(o.length<1)e(t.elem.combo_input).removeAttr("disabled");else{for(var i={},a=0;a<o.length;a++)i["p_"+a]=o[a];e.ajax({dataType:"json",url:t.option.shorten_src,data:i,success:function(o){var n=0,i=s.replace(t.option.shorten_reg,function(){var e=arguments[0].replace(arguments[1],o[n]);return n++,e});e(t.elem.combo_input).val(i),t.prop.prev_value=i,t._disableButtonShort(t)},error:function(e,s,o){t._ajaxErrorNotify(t,o)},complete:function(){e(t.elem.combo_input).removeAttr("disabled").focus()}})}},_ajaxErrorNotify:function(e,t){alert(e.message.ajax_error)},_scrollWindow:function(s,o){var n,i=s._getCurrentLine(s),a=i&&!o?i.offset().top:e(s.elem.container).offset().top;if(s.option.sub_info){var r=e(s.elem.sub_info).children("dl:visible");n=e(r).height()+parseInt(e(r).css("border-top-width"))+parseInt(e(r).css("border-bottom-width"))}else s.prop.size_li=e(s.elem.results).children("li:first").outerHeight(),n=s.prop.size_li;var l,p=e(t).height(),_=e(t).scrollTop(),c=_+p-n;if(e(i).length)if(a<_||n>p)l=a-_;else{if(!(a>c))return;l=a-c}else a<_&&(l=a-_);t.scrollBy(0,l)},_setCssFocusedInput:function(t){e(t.elem.results).addClass(t.css_class.re_off),e(t.elem.combo_input).removeClass(t.css_class.input_off),e(t.elem.sub_info).children("dl").hide()},_setCssFocusedResults:function(t){e(t.elem.results).removeClass(t.css_class.re_off),e(t.elem.combo_input).addClass(t.css_class.input_off)},_enableButtonShort:function(t){e(t.option.shorten_btn).removeClass(t.css_class.btn_short_off).removeAttr("disabled")},_disableButtonShort:function(t){e(t.option.shorten_btn).addClass(t.css_class.btn_short_off).attr("disabled","disabled")},_setTimerCheckValue:function(e){e.prop.timer_valchange=setTimeout(function(){e._checkValue(e)},500)},_checkValue:function(t){var s=e(t.elem.combo_input).val();if(s!=t.prop.prev_value)if(t.prop.prev_value=s,"textarea"==t.option.plugin_type){t._findUrlToShorten(t);var o=t._findTag(t,s);o&&(t._setTextAreaNewSearch(t,o),t._suggest(t))}else e(t.elem.combo_input).removeAttr("sub_info"),"textarea"!=t.option.plugin_type&&e(t.elem.hidden).val(""),t.option.select_only&&t._setButtonAttrDefault(),t.prop.page_suggest=1,t.prop.is_suggest=!0,t._suggest(t);else if("textarea"==t.option.plugin_type&&e(t.elem.result_area).is(":visible")){var n=t._findTag(t,s);n?n.str==t.prop.tag.str&&n.pos_left==t.prop.tag.pos_left||(t._setTextAreaNewSearch(t,n),t._suggest(t)):t._hideResults(t)}t._setTimerCheckValue(t)},_setTextAreaNewSearch:function(e,t){e.prop.tag=t,e.prop.page_suggest=1,e.option.search_field=e.option.tags[e.prop.tag.type].search_field,e.option.order_by=e.option.tags[e.prop.tag.type].order_by,e.option.primary_key=e.option.tags[e.prop.tag.type].primary_key,e.option.db_table=e.option.tags[e.prop.tag.type].db_table,e.option.field=e.option.tags[e.prop.tag.type].field,e.option.sub_info=e.option.tags[e.prop.tag.type].sub_info,e.option.sub_as=e.option.tags[e.prop.tag.type].sub_as,e.option.show_field=e.option.tags[e.prop.tag.type].show_field,e.option.hide_field=e.option.tags[e.prop.tag.type].hide_field},_findUrlToShorten:function(t){for(var s=null;null!==t.option.shorten_reg.exec(e(t.elem.combo_input).val());){s=!0,t.option.shorten_reg.lastIndex=0;break}s?t._enableButtonShort(t):t._disableButtonShort(t)},_findTag:function(t,s){for(var o,n,i,a,r,l=t._getCaretPosition(e(t.elem.combo_input).get(0)),p=0;p<t.option.tags.length;p++)if(o=s.substring(0,l),o=o.match(t.option.tags[p].pattern.reg_left))return o=o[1],(n=l-o.length)<0&&(n=0),i=s.substring(l,s.length),(i=i.match(t.option.tags[p].pattern.reg_right))?a=l+(i=i[1]).length:(i="",a=l),r=o+""+i,t.prop.is_suggest=""!==r,{type:p,str:r,pos_left:n,pos_right:a};return!1},_getCaretPosition:function(e){var t=0;if(s.selection){e.focus();var o=s.selection.createRange();o.moveStart("character",-e.value.length),t=o.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},_setCaretPosition:function(t,s){var o=e(t.elem.combo_input).get(0);if(o.setSelectionRange)o.focus(),o.setSelectionRange(s,s);else if(o.createTextRange){var n=o.createTextRange();n.collapse(!0),n.moveEnd("character",s),n.moveStart("character",s),n.select()}},_processKey:function(t,s){if(e.inArray(s.keyCode,[27,38,40,9])>-1&&e(t.elem.result_area).is(":visible")||e.inArray(s.keyCode,[37,39,13,9])>-1&&t._getCurrentLine(t)||40==s.keyCode&&"textarea"!=t.option.plugin_type)switch(s.preventDefault(),s.stopPropagation(),s.cancelBubble=!0,s.returnValue=!1,s.keyCode){case 37:s.shiftKey?t._firstPage(t):t._prevPage(t);break;case 38:t.prop.key_select=!0,t._prevLine(t);break;case 39:s.shiftKey?t._lastPage(t):t._nextPage(t);break;case 40:e(t.elem.results).children("li").length?(t.prop.key_select=!0,t._nextLine(t)):(t.prop.is_suggest=!1,t._suggest(t));break;case 9:t.prop.key_paging=!0,t._hideResults(t);break;case 13:t._selectCurrentLine(t,!0);break;case 27:t.prop.key_paging=!0,t._hideResults(t)}else 16!=s.keyCode&&t._setCssFocusedInput(t),t._checkValue(t)},_abortAjax:function(e){e.prop.xhr&&(e.prop.xhr.abort(),e.prop.xhr=!1)},_suggest:function(t){var s;if("textarea"!=t.option.plugin_type){if((s=t.prop.is_suggest?e.trim(e(t.elem.combo_input).val()):"").length<1&&t.prop.is_suggest)return void t._hideResults(t);s=s.split(/[\s　]+/)}else s=[t.prop.tag.str];if(t._abortAjax(t),t._setLoading(t),e(t.elem.sub_info).children("dl").hide(),t.prop.is_paging){var o=t._getCurrentLine(t);t.prop.is_paging=o?e(t.elem.results).children("li").index(o):-1}else t.prop.is_suggest||(t.prop.is_paging=0);var n=t.prop.is_suggest?t.prop.page_suggest:t.prop.page_all;"object"==typeof t.option.source?t._searchForJson(t,s,n):t._searchForDb(t,s,n)},_setLoading:function(t){e(t.elem.navi_info).text(t.message.loading),""===e(t.elem.results).html()&&(e(t.elem.navi).children("p").empty(),t._calcWidthResults(t),e(t.elem.container).addClass(t.css_class.container_open))},_searchForDb:function(t,s,o){t.prop.xhr=e.ajax({dataType:"json",url:t.option.source,data:{q_word:s,page_num:o,per_page:t.option.per_page,search_field:t.option.search_field,and_or:t.option.and_or,order_by:t.option.order_by,db_table:t.option.db_table},success:function(n){if(n.candidate=[],n.primary_key=[],n.subinfo=[],"object"!=typeof n.result)return t.prop.xhr=null,void t._notFoundSearch(t);for(n.cnt_page=n.result.length,i=0;i<n.cnt_page;i++){n.subinfo[i]=[];for(var a in n.result[i])if(a==t.option.primary_key&&n.primary_key.push(n.result[i][a]),a==t.option.field)n.candidate.push(n.result[i][a]);else if(-1==e.inArray(a,t.option.hide_field)){if(""!==t.option.show_field&&-1==e.inArray("*",t.option.show_field)&&-1==e.inArray(a,t.option.show_field))continue;n.subinfo[i][a]=n.result[i][a]}}delete n.result,t._prepareResults(t,n,s,o)},error:function(e,s,o){"abort"!=s&&(t._hideResults(t),t._ajaxErrorNotify(t,o))},complete:function(){t.prop.xhr=null}})},_searchForJson:function(t,s,n){var i=[],a=[],r=[],l={},p=0,_=[];do{a[p]=s[p].replace(/\W/g,"\\$&").toString(),_[p]=new RegExp(a[p],"gi"),p++}while(p<s.length);for(p=0;p<t.option.source.length;p++){for(var c=!1,u=0;u<_.length;u++)if(t.option.source[p][t.option.field].match(_[u])){if(c=!0,"OR"==t.option.and_or)break}else if(c=!1,"AND"==t.option.and_or)break;c&&i.push(t.option.source[p])}if(i.length!==o){l.cnt_whole=i.length;var g=new RegExp("^"+a[0]+"$","gi"),d=new RegExp("^"+a[0],"gi"),h=[],f=[],m=[];for(p=0;p<i.length;p++)i[p][t.option.order_by[0][0]].match(g)?h.push(i[p]):i[p][t.option.order_by[0][0]].match(d)?f.push(i[p]):m.push(i[p]);t.option.order_by[0][1].match(/^asc$/i)?(h=t._sortAsc(t,h),f=t._sortAsc(t,f),m=t._sortAsc(t,m)):(h=t._sortDesc(t,h),f=t._sortDesc(t,f),m=t._sortDesc(t,m)),r=r.concat(h).concat(f).concat(m);var b=(n-1)*t.option.per_page,v=b+t.option.per_page;for(p=b,sub=0;p<v&&r[p]!==o;p++,sub++)for(var y in r[p])if(y==t.option.primary_key&&(l.primary_key===o&&(l.primary_key=[]),l.primary_key.push(r[p][y])),y==t.option.field)l.candidate===o&&(l.candidate=[]),l.candidate.push(r[p][y]);else if(-1==e.inArray(y,t.option.hide_field)){if(""!==t.option.show_field&&-1==e.inArray("*",t.option.show_field)&&-1==e.inArray(y,t.option.show_field))continue;l.subinfo===o&&(l.subinfo=[]),l.subinfo[sub]===o&&(l.subinfo[sub]=[]),l.subinfo[sub][y]=r[p][y]}l.candidate===o&&(l.candidate=[]),l.cnt_page=l.candidate.length,t._prepareResults(t,l,s,n)}else t._notFoundSearch(t)},_sortAsc:function(e,t){return t.sort(function(t,s){return t[e.option.order_by[0][0]].localeCompare(s[e.option.order_by[0][0]])}),t},_sortDesc:function(e,t){return t.sort(function(t,s){return s[e.option.order_by[0][0]].localeCompare(t[e.option.order_by[0][0]])}),t},_notFoundSearch:function(t){e(t.elem.navi_info).text(t.message.not_found),e(t.elem.navi_p).hide(),e(t.elem.results).empty(),e(t.elem.sub_info).empty(),t._calcWidthResults(t),e(t.elem.container).addClass(t.css_class.container_open),t._setCssFocusedInput(t)},_prepareResults:function(t,s,o,n){if(t._setNavi(t,s.cnt_whole,s.cnt_page,n),s.subinfo&&t.option.sub_info||(s.subinfo=!1),s.primary_key||(s.primary_key=!1),t.option.select_only&&1===s.candidate.length&&s.candidate[0]==o[0]&&("textarea"!=t.option.plugin_type&&e(t.elem.hidden).val(s.primary_key[0]),this._setButtonAttrDefault()),t._displayResults(t,s.candidate,s.subinfo,s.primary_key),!1===t.prop.is_paging)t._setCssFocusedInput(t);else{var i=t.prop.is_paging,a=e(t.elem.results).children("li").length-1;i>a&&(i=a);var r=e(t.elem.results).children("li").eq(i);e(r).addClass(t.css_class.select),t._setSubInfo(t,r),t.prop.is_paging=!1,t._setCssFocusedResults(t)}},_setNavi:function(t,s,o,n){var i=t.option.per_page*(n-1)+1,a=i+o-1,r=t.message.page_info.replace("cnt_whole",s).replace("num_page_top",i).replace("num_page_end",a);e(t.elem.navi_info).text(r);var l=Math.ceil(s/t.option.per_page);if(l>1){e(t.elem.navi_p).empty(),t.prop.is_suggest?t.prop.max_suggest=l:t.prop.max_all=l;for(var p=n-Math.ceil((t.option.navi_num-1)/2),_=n+Math.floor((t.option.navi_num-1)/2);p<1;)p++,_++;for(;_>l;)_--;for(;_-p<t.option.navi_num-1&&p>1;)p--;1==n?(t.option.navi_simple||e("<span>").text("<< 1").addClass("page_end").appendTo(t.elem.navi_p),e("<span>").text(t.message.prev).addClass("page_end").appendTo(t.elem.navi_p)):(t.option.navi_simple||e("<a>").attr({href:"javascript:void(0)",class:"navi_first"}).text("<< 1").attr("title",t.message.first_title).appendTo(t.elem.navi_p),e("<a>").attr({href:"javascript:void(0)",class:"navi_prev",title:t.message.prev_title}).text(t.message.prev).appendTo(t.elem.navi_p));for(var c=p;c<=_;c++){var u=c==n?'<span class="current">'+c+"</span>":c;e("<a>").attr({href:"javascript:void(0)",class:"navi_page"}).html(u).appendTo(t.elem.navi_p)}n==l?(e("<span>").text(t.message.next).addClass("page_end").appendTo(t.elem.navi_p),t.option.navi_simple||e("<span>").text(l+" >>").addClass("page_end").appendTo(t.elem.navi_p)):(e("<a>").attr({href:"javascript:void(0)",class:"navi_next"}).text(t.message.next).attr("title",t.message.next_title).appendTo(t.elem.navi_p),t.option.navi_simple||e("<a>").attr({href:"javascript:void(0)",class:"navi_last"}).text(l+" >>").attr("title",t.message.last_title).appendTo(t.elem.navi_p)),e(t.elem.navi_p).show(),t._ehNaviPaging(t)}else e(t.elem.navi_p).hide()},_setSubInfo:function(t,s){if(t.option.sub_info){t.prop.size_results=(e(t.elem.results).outerHeight()-e(t.elem.results).height())/2,t.prop.size_navi=e(t.elem.navi).outerHeight(),t.prop.size_li=e(t.elem.results).children("li:first").outerHeight(),t.prop.size_left=e(t.elem.results).outerWidth();var o=e(t.elem.results).children("li").index(s);e(t.elem.sub_info).children("dl").hide();var n=0;"none"!=e(t.elem.navi).css("display")&&(n+=t.prop.size_navi),n+=t.prop.size_results+t.prop.size_li*o;var i=t.prop.size_left;n+="px",i+="px",e(t.elem.sub_info).children("dl").eq(o).css({position:"absolute",top:n,left:i,display:"block"})}},_displayResults:function(t,s,o,n){e(t.elem.results).empty(),e(t.elem.sub_info).empty();for(var i=0;i<s.length;i++){var a=e("<li>").text(s[i]).attr({pkey:n[i],title:s[i]});if("textarea"!=t.option.plugin_type&&n[i]==e(t.elem.hidden).val()&&e(a).addClass(t.css_class.selected),e(t.elem.results).append(a),o){var r,l,p=[],_=e("<dl>");for(var c in o[i]){var u=c.replace("'","\\'");null===o[i][c]?o[i][c]="":o[i][c]+="";var g=o[i][c].replace("'","\\'");p.push("'"+u+"':'"+g+"'"),r=t.option.sub_as[c]?t.option.sub_as[c]:c,r=e("<dt>").text(r),"simple"==t.option.sub_info&&e(r).addClass("hide"),_.append(r),l=e("<dd>").text(o[i][c]),_.append(l)}p="{"+p.join(",")+"}",e(a).attr("sub_info",p),e(t.elem.sub_info).append(_),"simple"==t.option.sub_info&&""===_.children("dd").text()&&_.addClass("ac_dl_empty")}}t._calcWidthResults(t),e(t.elem.container).addClass(t.css_class.container_open),t._ehResults(),"combobox"==t.option.plugin_type&&e(t.elem.button).attr("title",t.message.close_btn)},_calcWidthResults:function(t){var s;if(s="combobox"==t.option.plugin_type?e(t.elem.combo_input).outerWidth()+e(t.elem.button).outerWidth():e(t.elem.combo_input).outerWidth(),e(t.elem.container).width(s),"static"==e(t.elem.container).css("position")){var o=e(t.elem.combo_input).offset();e(t.elem.result_area).css({top:o.top+e(t.elem.combo_input).outerHeight()+"px",left:o.left+"px"})}else e(t.elem.result_area).css({top:e(t.elem.combo_input).outerHeight()+"px",left:"0px"});e(t.elem.result_area).width(e(t.elem.container).width()-(e(t.elem.result_area).outerWidth()-e(t.elem.result_area).innerWidth())).show()},_hideResults:function(t){t.prop.key_paging&&(t._scrollWindow(t,!0),t.prop.key_paging=!1),t._setCssFocusedInput(t),e(t.elem.results).empty(),e(t.elem.sub_info).empty(),e(t.elem.result_area).hide(),e(t.elem.container).removeClass(t.css_class.container_open),t._abortAjax(t),t._setButtonAttrDefault()},_firstPage:function(e){e.prop.is_suggest?e.prop.page_suggest>1&&(e.prop.page_suggest=1,e.prop.is_paging=!0,e._suggest(e)):e.prop.page_all>1&&(e.prop.page_all=1,e.prop.is_paging=!0,e._suggest(e))},_prevPage:function(e){e.prop.is_suggest?e.prop.page_suggest>1&&(e.prop.page_suggest--,e.prop.is_paging=!0,e._suggest(e)):e.prop.page_all>1&&(e.prop.page_all--,e.prop.is_paging=!0,e._suggest(e))},_nextPage:function(e){e.prop.is_suggest?e.prop.page_suggest<e.prop.max_suggest&&(e.prop.page_suggest++,e.prop.is_paging=!0,e._suggest(e)):e.prop.page_all<e.prop.max_all&&(e.prop.page_all++,e.prop.is_paging=!0,e._suggest(e))},_lastPage:function(e){e.prop.is_suggest?e.prop.page_suggest<e.prop.max_suggest&&(e.prop.page_suggest=e.prop.max_suggest,e.prop.is_paging=!0,e._suggest(e)):e.prop.page_all<e.prop.max_all&&(e.prop.page_all=e.prop.max_all,e.prop.is_paging=!0,e._suggest(e))},_selectCurrentLine:function(t,s){t._scrollWindow(t,!0);var o=t._getCurrentLine(t);if(o){if("textarea"!=t.option.plugin_type)e(t.elem.combo_input).val(e(o).text()),t.option.sub_info&&e(t.elem.combo_input).attr("sub_info",e(o).attr("sub_info")),t.option.select_only&&t._setButtonAttrDefault(),e(t.elem.hidden).val(e(o).attr("pkey"));else{var n,i,a,r,l=t.prop.prev_value.substring(0,t.prop.tag.pos_left),p=t.prop.prev_value.substring(t.prop.tag.pos_right);n=e(o).text(),t.option.tags[t.prop.tag.type].space[0]&&!l.match(t.option.tags[t.prop.tag.type].pattern.space_left)&&(i=t.option.tags[t.prop.tag.type].pattern.left.length,a=l.length,l=l.substring(0,a-i)+" "+l.substring(a-i)),p.match(t.option.tags[t.prop.tag.type].pattern.comp_right)||(p=t.option.tags[t.prop.tag.type].pattern.right+p),t.option.tags[t.prop.tag.type].space[1]&&!p.match(t.option.tags[t.prop.tag.type].pattern.space_right)&&(i=t.option.tags[t.prop.tag.type].pattern.right.length,p=p.substring(0,i)+" "+p.substring(i)),e(t.elem.combo_input).val(l+""+n+p),r=l.length+n.length,t._setCaretPosition(t,r)}t.prop.prev_value=e(t.elem.combo_input).val(),t._hideResults(t)}t.option.bind_to&&e(t.elem.combo_input).trigger(t.option.bind_to,s),e(t.elem.combo_input).focus(),e(t.elem.combo_input).change(),t._setCssFocusedInput(t)},_getCurrentLine:function(t){if(e(t.elem.result_area).is(":hidden"))return!1;var s=e(t.elem.results).children("li."+t.css_class.select);return!!e(s).length&&s},_nextLine:function(t){var s,o=t._getCurrentLine(t);if(o?(s=e(t.elem.results).children("li").index(o),e(o).removeClass(t.css_class.select)):s=-1,++s<e(t.elem.results).children("li").length){var n=e(t.elem.results).children("li").eq(s);t._setSubInfo(t,n),e(n).addClass(t.css_class.select),t._setCssFocusedResults(t)}else t._setCssFocusedInput(t);t._scrollWindow(t,!1)},_prevLine:function(t){var s,o=t._getCurrentLine(t);if(o?(s=e(t.elem.results).children("li").index(o),e(o).removeClass(t.css_class.select)):s=e(t.elem.results).children("li").length,--s>-1){var n=e(t.elem.results).children("li").eq(s);t._setSubInfo(t,n),e(n).addClass(t.css_class.select),t._setCssFocusedResults(t)}else t._setCssFocusedInput(t);t._scrollWindow(t,!1)}})});